<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for pinyin/index.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../prettify.css">
    <link rel="stylesheet" href="../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header high">
    <h1>Code coverage report for <span class="entity">pinyin/index.js</span></h1>
    <h2>
        Statements: <span class="metric">87.04% <small>(47 / 54)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">87.5% <small>(21 / 24)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">100% <small>(5 / 5)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">87.04% <small>(47 / 54)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../index.html">All files</a> &#187; <a href="index.html">pinyin/</a> &#187; index.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">65</span>
<span class="cline-any cline-yes">65</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">65</span>
<span class="cline-any cline-yes">65</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">25</span>
<span class="cline-any cline-yes">25</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-yes">20</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">25</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">195</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">195</span>
<span class="cline-any cline-yes">195</span>
<span class="cline-any cline-yes">195</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">195</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">510</span>
<span class="cline-any cline-yes">510</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">510</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">260</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">260</span>
<span class="cline-any cline-yes">235</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">25</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">250</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">195</span>
<span class="cline-any cline-yes">60</span>
<span class="cline-any cline-yes">60</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">195</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">"use strict";
&nbsp;
const utils = require("./src/utils");
const PINYIN_DICT = require("./data/dict-zi");
const pinyin = require("./src/pinyin");
let jieba;
let PHRASES_DICT;
&nbsp;
pinyin.setDict(PINYIN_DICT);
&nbsp;
function segment(hans) {
  try {
    jieba = jieba || require("nodejieba");
  } catch (ex) {
<span class="cstat-no" title="statement not covered" >    console.error();</span>
<span class="cstat-no" title="statement not covered" >    console.error("    Segment need nodejieba, please run '$ npm install nodejieba'.");</span>
<span class="cstat-no" title="statement not covered" >    console.error("    分词需要使用 nodejieba 模块，请运行 '$ npm install nodejieba' 并确保安装完成。");</span>
<span class="cstat-no" title="statement not covered" >    console.error();</span>
<span class="cstat-no" title="statement not covered" >    throw ex;</span>
  }
  // 词语拼音库。
  PHRASES_DICT = PHRASES_DICT || require("./data/phrases-dict");
  return jieba.cut(hans);
}
&nbsp;
// 词语注音
// @param {String} phrases, 指定的词组。
// @param {Object} options, 选项。
// @return {Array}
function phrases_pinyin(phrases, options) {
  var py = [];
  if (PHRASES_DICT.hasOwnProperty(phrases)){
    //! copy pinyin result.
    PHRASES_DICT[phrases].forEach(function(item, idx){
      py[idx] = [];
      <span class="missing-if-branch" title="else path not taken" >E</span>if (options.heteronym){
        item.forEach(function(py_item, py_index){
          py[idx][py_index] = pinyin.toFixed(py_item, options.style);
        });
      } else {
<span class="cstat-no" title="statement not covered" >        py[idx][0] = pinyin.toFixed(item[0], options.style);</span>
      }
    });
  } else {
    for(var i = 0, l = phrases.length; i &lt; l; i++){
      py = py.concat(pinyin(phrases[i], options));
    }
  }
  return py;
}
&nbsp;
// @param {String} hans 要转为拼音的目标字符串（汉字）。
// @param {Object} options, 可选，用于指定拼音风格，是否启用多音字。
// @return {Array} 返回的拼音列表。
module.exports = function(hans, options) {
&nbsp;
  <span class="missing-if-branch" title="if path not taken" >I</span>if(typeof hans !== "string"){
<span class="cstat-no" title="statement not covered" >    return [];</span>
  }
&nbsp;
  options = utils.extend(utils.DEFAULT_OPTIONS, options || <span class="branch-1 cbranch-no" title="branch not covered" >{})</span>;
  var phrases = options &amp;&amp; options.segment ? segment(hans) : hans;
  var pys = [];
&nbsp;
  for(var i = 0, nohans = "", firstCharCode, words, l = phrases.length; i &lt; l; i++){
&nbsp;
    words = phrases[i];
    firstCharCode = words.charCodeAt(0);
&nbsp;
    if(PINYIN_DICT[firstCharCode]){
&nbsp;
      // ends of non-chinese words.
      if(nohans.length &gt; 0){
        pys.push([nohans]);
        nohans = ""; // reset non-chinese words.
      }
&nbsp;
      if(words.length === 1){
        pys = pys.concat(pinyin(words, options));
      }else{
        pys = pys.concat(phrases_pinyin(words, options));
      }
&nbsp;
    }else{
      nohans += words;
    }
  }
&nbsp;
  // 清理最后的非中文字符串。
  if(nohans.length &gt; 0){
    pys.push([nohans]);
    nohans = ""; // reset non-chinese words.
  }
&nbsp;
  return pys;
};
module.exports.STYLE_NORMAL = utils.PINYIN_STYLE.NORMAL;
module.exports.STYLE_TONE = utils.PINYIN_STYLE.TONE;
module.exports.STYLE_TONE2 = utils.PINYIN_STYLE.TONE2;
module.exports.STYLE_INITIALS = utils.PINYIN_STYLE.INITIALS;
module.exports.STYLE_FIRST_LETTER = utils.PINYIN_STYLE.FIRST_LETTER;
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun Aug 23 2015 12:57:54 GMT+0800 (CST)</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
