---
title: 即书服务器搭建记录
date: 2018-06-22 11:35:38
tags: [记录, 服务器, Ubuntu]
categories: Linux
---
<blockquote class="blockquote-center">学而践行之</blockquote>

<!--more-->

服务器环境： *Ubuntu: V16.04*

# 软件列表

 | 环境 | 版本 |
 | -------- | -------- |
 | Nginx    | V1.10.3  |
 | PHP      | V7.1.18 |
 | MySQL    | V5.7.22 |
 | Redis    | V3.1.6  |
 | Git      | V2.7.4 |
 | libreoffice| V5.4  |
 | inkscape | -  |
 | lrzsz    | V0.12.21-8 |
 | tmux     | V2.1.3  |
 
# 准备
> 更新软件源为阿里源
```bash :/etc/apt/source.list
    # 备份
    sudo cp /etc/apt/sources.list /etc/apt/sources.list.old
    
    # vim: /etc/apt/source.list
    # deb cdrom:[Ubuntu 16.04 LTS _Xenial Xerus_ - Release amd64 (20160420.1)]/ xenial main restricted
    deb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-properties
    deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted
    deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-properties
    deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted
    deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-properties
    deb http://mirrors.aliyun.com/ubuntu/ xenial universe
    deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe
    deb http://mirrors.aliyun.com/ubuntu/ xenial multiverse
    deb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse
    deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse
    deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse #Added by software-properties
    deb http://archive.canonical.com/ubuntu xenial partner
    deb-src http://archive.canonical.com/ubuntu xenial partner
    deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted
    deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe #Added by software-properties
    deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe
    deb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse
    
    # 执行更新
    sudo apt-get update
```

```shell :#@Ubuntu:>_ line_number:false
    sudo apt-add-repository ppa:ondrej/php   # 添加 PHP 软件源
    sudo add-apt-repository ppa:libreoffice/libreoffice-5-4    # 添加 Libreoffice5.4 软件源
    报错则执行：
        1. sudo apt-get install python-software-properties
        2. sudo apt-get install software-properties-common
    
    sudo apt-get update    # 更新软件源
```

-----

# 安装 Web 服务器环境
 [Nginx](#Nginx), [PHP](#PHP), [MySql](#MySql)

## Nginx
直接命令安装：`sudo apt-get install nginx` 
启动 Nginx ：`sudo service nginx start`

>相关命令：
- netstat -anp | grep nginx    查看Nginx进程
- lsof -i:80                   查看80端口状态
    
## PHP
命令安装：`sudo apt-get install php7.1`
安装fpm：`sudo apt-get install php7.1-fpm`

>相关命令：
- php -v  安装完后检查
- php -m  已安装的 PHP 模块

## MySql
命令安装：`apt-get install mysql-server mysql-client php7.1-mysql`
> 在安装过程中会提示输入 root 用户的登录密码

## Nginx 解析 PHP 
>PHP-FPM 与 Nginx 通信方式有两种，一种是基于TCP的 Internet domain socket 方式，一种是 UNIX domain socket 方式。 推荐使用第二种连接方式 Socket 路径为：/run/php/php7.1-fpm.sock

```nginx :nginx.conf
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        # With php7.0-cgi alone:
        # fastcgi_pass 127.0.0.1:9000;
        # With php7.0-fpm:
        fastcgi_pass unix:/run/php/php7.1-fpm.sock;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        include        fastcgi_params;
    }
```

```ini :/etc/php/7.1/fpm/pool.d/www.conf
    ; 与 Nginx监听同一个 sock
    listen = /run/php/php7.1-fpm.sock
```
## Redis 的安装
```bash
# 先安装 redis-server 和 redis-tools, 以及 编译PHP扩展包工具
sudo apt-get install redis-server redis-tools php7.1-dev

# 安装 php-redis 扩展 依次执行
phpize7.1
./configure --with-php-config=/usr/bin/php-config
make
sudo make install

# 安装完成后添加 扩展
echo "extension=redis.so" >> /etc/php/7.1/mods-available/redis.ini
sudo ln -s /etc/php/7.1/mods-available/redis.ini /etc/php/7.1/cli/conf.d/20-redis.ini
sudo ln -s /etc/php/7.1/mods-available/redis.ini /etc/php/7.1/fpm/conf.d/20-redis.ini
```

# 应用软件
1. sudo apt-get install libreoffice   # 开源办公套件
> eg： 将 word/ppt/excel 转换为 pdf ： `libreoffice  --invisible --convert-to pdf  demo.docx  `
    
2. sudo apt-get install inksacpe      # 矢量图转换工具
> eg： 将 emf 转换为 png ： `inkscape -e output.png input.emf`

3. sudo apt-get install lrzsz         # linux 快速传输工具
> eg： 上传文件 `rz`， 下载文件 `sz filename`

4. sudo apt-get install git           

# 其他配置

## tmux 配置

```ini :~/.tmux.conf url:https://gitee.com/kongvip/config/blob/master/tmux.config 链接地址
# 设置前缀为Ctrl + a
set -g prefix C-x

#解除Ctrl+b 与前缀的对应关系
unbind C-b

## 切换面板
#up
bind-key k select-pane -U
#down
bind-key j select-pane -D
#left
bind-key h select-pane -L
#right
bind-key l select-pane -R
```

# 其他命令 
[点击跳转](https://kjh123.github.io/2018/06/27/Linux%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0/)

